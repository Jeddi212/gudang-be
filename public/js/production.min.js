function calculateSum(t){var e=document.querySelectorAll(`input[name="quantity[]"][data-material="${t}"]`),a=0;return e.forEach(t=>{a+=parseInt(t.value)||0}),a}function updateNeedsUI(){var t=parseInt(document.getElementById("product-quantity").value,10);document.querySelectorAll(".needs").forEach(e=>{var a=parseInt(e.dataset.quantity,10);e.textContent=`Needs: ${a*t}`})}function updateMax(t,e){var a=t.selectedIndex,n=t.options[a].getAttribute("data-stock"),u=parseInt(document.getElementById("product-quantity").value,10);t.nextElementSibling.setAttribute("max",Math.min(e*u,n))}function validateQInput(t){var e=parseInt(t.min),a=parseInt(t.max),n=parseInt(t.value);isNaN(n)||n<e?t.value=e:n>a?t.value=a:0===n&&(t.value=e)}function validateQuantity(t,e){var a=document.getElementById("product-quantity").value,n=parseInt(e,10)*parseInt(a,10),u=calculateSum(t,n),r=document.getElementById(`${t}ErrorMessage`);u!==n?r.textContent=`Sum of quantities must be equal to ${n}. Current sum: ${u}`:r.textContent=""}function validateQuantityAll(){var t=document.getElementById("product-quantity").value;document.querySelectorAll(".qty").forEach(e=>{var a=e.getAttribute("data-material"),n=parseInt(e.getAttribute("data-quantity"),10)*parseInt(t,10),u=calculateSum(a,n),r=document.getElementById(`${a}ErrorMessage`);u!==n?r.textContent=`Sum of quantities must be equal to ${n}. Current sum: ${u}`:r.textContent=""})}function validateSubmit(){for(var t=document.getElementById("product-quantity").value,e=document.querySelectorAll(".qty"),a=0;a<e.length;a++){var n=e[a],u=n.getAttribute("data-material"),r=parseInt(n.getAttribute("data-quantity"),10)*parseInt(t,10),l=calculateSum(u,r),i=document.getElementById(`${u}ErrorMessage`);if(l!==r)return i.textContent=`Sum of quantities must be equal to ${r}. Current sum: ${l}`,!1;i.textContent=""}return!0}function removeSplit(t){if(confirm("Are you sure you want to remove this item?")){var e=t.parentElement;e.parentElement.removeChild(e)}}const collectForm=()=>{let t=document.getElementById("event").value,e=Array.from(document.querySelectorAll(".inventory-item")).map(t=>({product:t.querySelector('[name="product[]"]').value,warehouse:t.querySelector('[name="warehouse[]"]').value,quantity:Number(t.querySelector('[name="quantity[]"]').value)}));for(let a=1;a<e.length;a++)e[a].quantity>0&&(e[a].quantity=-e[a].quantity);return JSON.stringify({event:t,inventory:e})};document.getElementById("jsonForm").addEventListener("submit",async t=>{if(t.preventDefault(),!validateSubmit()){alert("Some quantity are incorrect. Please check the quantities.");return}let e=document.getElementById("result");e.setAttribute("aria-busy","true");try{let a=collectForm(),n=t.target.action,u=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:a});if(u.ok){let r=await u.json(),l=r.data.transaction.id;window.location.href=`/transaction/${l}`}else{let i=await u.text();e.innerHTML=i}}catch(o){e.innerHTML=o}e.setAttribute("aria-busy","false")});